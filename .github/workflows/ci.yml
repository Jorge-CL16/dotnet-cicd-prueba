docker-build:
    name: Docker Build
    runs-on: ubuntu-latest
    needs: build-and-test
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      # â­ NUEVO: Ver estructura del proyecto
      - name: ğŸ” Debug - List project structure
        run: |
          echo "ğŸ“ Current directory:"
          pwd
          echo ""
          echo "ğŸ“‚ Files in root:"
          ls -la
          echo ""
          echo "ğŸ“„ Dockerfile content:"
          cat Dockerfile
      
      - name: ğŸ³ Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      # â­ MODIFICADO: Build con mÃ¡s verbose
      - name: ğŸ—ï¸ Build Docker image
        run: |
          echo "ğŸ”¨ Building Docker image..."
          docker build --progress=plain -t myapi:${{ github.sha }} . 2>&1 | tee build.log
          
          echo ""
          echo "âœ… Build completed. Verifying image..."
          docker images | grep myapi || echo "âŒ Image not found!"
      
      - name: ğŸ§ª Test Docker image
        run: |
          echo "ğŸš€ Starting container..."
          docker run -d -p 8080:8080 --name test-container myapi:${{ github.sha }}
          
          echo "ğŸ“‹ Container status:"
          docker ps -a
          
          echo ""
          echo "ğŸ“„ Container logs:"
          docker logs test-container
          
          echo ""
          echo "â³ Waiting 15 seconds for app to start..."
          sleep 15
          
          echo "ğŸ” Testing health endpoint..."
          curl -v http://localhost:8080/health || {
            echo "âŒ Health check failed. Container logs:"
            docker logs test-container
            exit 1
          }
          
          echo ""
          echo "ğŸ” Testing weatherforecast endpoint..."
          curl -v http://localhost:8080/weatherforecast || {
            echo "âŒ API test failed. Container logs:"
            docker logs test-container
            exit 1
          }
          
          echo ""
          echo "âœ… All tests passed!"
          docker stop test-container